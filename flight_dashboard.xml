<testset xmlns="http://cpee.org/ns/properties/2.0">
  <executionhandler>ruby</executionhandler>
  <dataelements>
    <flights_raw>{"time":1753288138,"states":[["3c4dca","DLH1YR  ","Germany",1753288077,1753288077,11.8313,48.3676,502.92,false,74.02,263.62,-2.6,null,548.64,"1000",false,0],["a7ea7e","UPS9    ","United States",1753287956,1753287956,11.2439,48.206,9753.6,false,245.82,307.52,0,null,10119.36,null,false,0],["3e2907","DIGST   ","Germany",1753287956,1753287956,11.3849,48.1878,2788.92,false,142.26,326.65,-9.75,null,2903.22,null,false,0],["4cade7","RYR1MQ  ","Ireland",1753288137,1753288138,11.4209,48.5421,11277.6,false,235.21,132.52,-0.33,null,11635.74,"7662",false,0]]}</flights_raw>
    <flights_dashboard>[{"airline":"DLH1YR","flight":"DLH1YR","from":"München (MUC)","to":"Germany","qr":"https://www.flightradar24.com/data/flights/dlh1yr"},{"airline":"UPS9","flight":"UPS9","from":"München (MUC)","to":"United States","qr":"https://www.flightradar24.com/data/flights/ups9"},{"airline":"DIGST","flight":"DIGST","from":"München (MUC)","to":"Germany","qr":"https://www.flightradar24.com/data/flights/digst"},{"airline":"RYR1MQ","flight":"RYR1MQ","from":"München (MUC)","to":"Ireland","qr":"https://www.flightradar24.com/data/flights/ryr1mq"}]</flights_dashboard>
    <encoded_dashboard>%5B%7B%22airline%22%3A%22DLH1YR%22%2C%22flight%22%3A%22DLH1YR%22%2C%22from%22%3A%22M%C3%BCnchen+%28MUC%29%22%2C%22to%22%3A%22Germany%22%2C%22qr%22%3A%22https%3A%2F%2Fwww.flightradar24.com%2Fdata%2Fflights%2Fdlh1yr%22%7D%2C%7B%22airline%22%3A%22UPS9%22%2C%22flight%22%3A%22UPS9%22%2C%22from%22%3A%22M%C3%BCnchen+%28MUC%29%22%2C%22to%22%3A%22United+States%22%2C%22qr%22%3A%22https%3A%2F%2Fwww.flightradar24.com%2Fdata%2Fflights%2Fups9%22%7D%2C%7B%22airline%22%3A%22DIGST%22%2C%22flight%22%3A%22DIGST%22%2C%22from%22%3A%22M%C3%BCnchen+%28MUC%29%22%2C%22to%22%3A%22Germany%22%2C%22qr%22%3A%22https%3A%2F%2Fwww.flightradar24.com%2Fdata%2Fflights%2Fdigst%22%7D%2C%7B%22airline%22%3A%22RYR1MQ%22%2C%22flight%22%3A%22RYR1MQ%22%2C%22from%22%3A%22M%C3%BCnchen+%28MUC%29%22%2C%22to%22%3A%22Ireland%22%2C%22qr%22%3A%22https%3A%2F%2Fwww.flightradar24.com%2Fdata%2Fflights%2Fryr1mq%22%7D%5D</encoded_dashboard>
  </dataelements>
  <endpoints>
    <user>https-post://cpee.org/services/timeout-user.php</user>
    <auto>https-post://cpee.org/services/timeout-auto.php</auto>
    <sensor>sensor</sensor>
    <human>human</human>
    <subprocess>https-post://cpee.org/flow/start/url/</subprocess>
    <plc>plc</plc>
    <timeout>https-post://cpee.org/services/timeout.php</timeout>
    <send>https-post://cpee.org/ing/correlators/message/send/</send>
    <get_flights>https://opensky-network.org/api/states/all?lamin=47.8&amp;lamax=48.6&amp;lomin=11.2&amp;lomax=12.0</get_flights>
    <robot_subprocess>robot_subprocess</robot_subprocess>
    <receive>receive</receive>
    <wait>wait</wait>
    <frames_display>https-put://cpee.org/out/frames/flights/</frames_display>
    <frames_init>https-post://cpee.org/out/frames/flights/</frames_init>
    <flight_endpoint>http://lehre.bpm.in.tum.de/ports/8081/flights</flight_endpoint>
  </endpoints>
  <attributes>
    <guarded>none</guarded>
    <info>flight_dashboard</info>
    <modeltype>CPEE</modeltype>
    <theme>extended</theme>
    <guarded_id/>
    <creator>Christine Ashcreek</creator>
    <author>Christine Ashcreek</author>
    <model_uuid>76e23583-e1c3-446d-9ecd-9becfeadba73</model_uuid>
    <model_version/>
    <design_stage>draft</design_stage>
    <design_dir>Teaching.dir/Prak.dir/TUM-Prak-25-SS.dir/Hami_Aslani.dir</design_dir>
  </attributes>
  <description>
    <description xmlns="http://cpee.org/ns/description/1.0">
      <call id="a1" endpoint="get_flights">
        <parameters>
          <label>Get Flights</label>
          <method>:get</method>
          <arguments>
            <data>!data.flights_dashboard</data>
          </arguments>
        </parameters>
        <code>
          <prepare/>
          <finalize output="result">require 'json'
require 'uri'

if result &amp;&amp; result["states"]
  data.flights_raw = result.to_json  # &lt;-- raw speichern!

  flights = result["states"]
    .select { |f| f[1] &amp;&amp; f[1].strip.length &gt; 2 }
    .first(4)
    .map do |f|
      callsign = f[1]&amp;.strip || "n/a"
      {
        airline: callsign.split(" ")[0],
        flight: callsign,
        from: "München (MUC)",
        to: f[2]&amp;.strip || "Unbekannt",
        qr: "https://www.flightradar24.com/data/flights/#{callsign.downcase}"
      }
    end

  data.flights_dashboard = flights.to_json
  data.encoded_dashboard = URI.encode_www_form_component(flights.to_json)
else
  data.flights_raw = {}.to_json
  data.flights_dashboard = [].to_json
  data.encoded_dashboard = URI.encode_www_form_component([].to_json)
end</finalize>
          <update output="result"/>
          <rescue output="result"/>
        </code>
        <annotations>
          <_generic/>
          <_timing>
            <_timing_weight/>
            <_timing_avg/>
            <explanations/>
          </_timing>
          <_shifting>
            <_shifting_type>Duration</_shifting_type>
          </_shifting>
          <_context_data_analysis>
            <probes/>
            <ips/>
          </_context_data_analysis>
          <report>
            <url/>
          </report>
          <_notes>
            <_notes_general/>
          </_notes>
        </annotations>
        <documentation>
          <input/>
          <output/>
          <implementation>
            <description/>
          </implementation>
          <code>
            <description/>
          </code>
        </documentation>
      </call>
      <call id="a5" endpoint="flight_endpoint">
        <parameters>
          <label>Update Flights</label>
          <method>:post</method>
          <arguments>
            <data>!data.flights_dashboard</data>
          </arguments>
        </parameters>
        <code>
          <prepare/>
          <finalize output="result"/>
          <update output="result"/>
          <rescue output="result"/>
        </code>
        <annotations>
          <_generic/>
          <_timing>
            <_timing_weight/>
            <_timing_avg/>
            <explanations/>
          </_timing>
          <_shifting>
            <_shifting_type>Duration</_shifting_type>
          </_shifting>
          <_context_data_analysis>
            <probes/>
            <ips/>
          </_context_data_analysis>
          <report>
            <url/>
          </report>
          <_notes>
            <_notes_general/>
          </_notes>
        </annotations>
        <documentation>
          <input/>
          <output/>
          <implementation>
            <description/>
          </implementation>
          <code>
            <description/>
          </code>
        </documentation>
      </call>
      <stop id="a3"/>
      <call id="a2" endpoint="frames_display">
        <parameters>
          <label>frame display</label>
          <arguments>
            <type>set</type>
            <lx>0</lx>
            <ly>1</ly>
            <x_amount>8</x_amount>
            <y_amount>8</y_amount>
            <button/>
            <style/>
            <urls>
              <urls_item>
                <lang>de-at</lang>
                <url>https://lehre.bpm.in.tum.de/~go36jas/flights/dashboard.html</url>
              </urls_item>
            </urls>
            <default>
              <data>!data.flights_dashboard</data>
            </default>
          </arguments>
        </parameters>
        <code>
          <prepare/>
          <finalize output="result"/>
          <update output="result"/>
          <rescue output="result"/>
        </code>
        <annotations>
          <_generic/>
          <_timing>
            <_timing_weight/>
            <_timing_avg/>
            <explanations/>
          </_timing>
          <_shifting>
            <_shifting_type>Duration</_shifting_type>
          </_shifting>
          <_context_data_analysis>
            <probes/>
            <ips/>
          </_context_data_analysis>
          <report>
            <url/>
          </report>
          <_notes>
            <_notes_general/>
          </_notes>
        </annotations>
        <documentation>
          <input/>
          <output/>
          <implementation>
            <description/>
          </implementation>
          <code>
            <description/>
          </code>
        </documentation>
      </call>
      <stop id="a6"/>
      <loop mode="pre_test" condition="">
        <_probability>
          <_probability_min/>
          <_probability_max/>
          <_probability_avg/>
        </_probability>
      </loop>
      <stop id="a4"/>
    </description>
  </description>
  <transformation>
    <description type="copy"/>
    <dataelements type="none"/>
    <endpoints type="none"/>
  </transformation>
</testset>